{% extends "layout.html" %}
{% block title %}Gestione Spesa{% endblock %}
{% block content %}

<!-- Contenitore principale a due colonne -->
<div class="flex-container">

    <!-- Pannello di Sinistra: Modifica dettagli principali -->
    <div class="panel">
        <h2>Modifica la Spesa</h2>
        <form method="post" action="{{ url_for('edit_spesa', id=spesa.id) }}">
            <div class="form-group">
                <label for="descrizione">Descrizione</label>
                <input type="text" name="descrizione" id="descrizione" value="{{ spesa.descrizione }}" required>
            </div>
            <div class="form-group">
                <label for="importo">Importo Previsto</label>
                <input type="text" name="importo" id="importo" value="{{ spesa.importo }}" required>
            </div>
            <div class="form-group">
                <label for="categoria">Categoria</label>
                <select name="categoria" id="categoria" required>
                    {% for category in categories %}
                    <option value="{{ category }}" {% if category == spesa.categoria %}selected{% endif %}>
                        {{ category }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit">Salva Modifiche Dettagli</button>
        </form>
    </div>

    <!-- Pannello di Destra: Gestione Pagamenti -->
    <div class="panel">
        <h2>Gestione Pagamenti</h2>

        <!-- Riepilogo finanziario per questa spesa -->
        <div class="summary-cards">
            <div class="card">
                <h3>Costo Previsto</h3>
                <p>€ {{ "%.2f"|format(spesa.importo) }}</p>
            </div>
            <div class="card">
                <h3>Pagato</h3>
                <p>€ {{ "%.2f"|format(totale_pagato) }}</p>
            </div>
            <div class="card remaining">
                <h3>Residuo</h3>
                <p>€ {{ "%.2f"|format(rimanente_da_pagare) }}</p>
            </div>
        </div>

        <hr class="section-divider">

        <!-- Form per aggiungere un nuovo pagamento -->
        <h4>Aggiungi Acconto</h4>
        <form method="post" action="{{ url_for('add_pagamento', spesa_id=spesa.id) }}">
             <div class="form-group">
                <label for="importo_pagato">Importo</label>
                <input type="text" name="importo_pagato" id="importo_pagato" placeholder="Es. 500.00" required>
            </div>
            <div class="form-group">
                <label for="data_pagamento">Data</label>
                <input type="date" name="data_pagamento" id="data_pagamento" required>
            </div>
             <div class="form-group">
                <label for="note">Note</label>
                <input type="text" name="note" id="note" placeholder="Es. Acconto">
            </div>
            <button type="submit">Aggiungi Pagamento</button>
        </form>

        <hr class="section-divider">

        <!-- Tabella con lo storico dei pagamenti -->
        <h4>Storico Pagamenti</h4>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Importo</th>
                        <th>Note</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in pagamenti %}
                    <tr>
                        <td>{{ p.data_pagamento }}</td>
                        <td>€ {{ "%.2f"|format(p.importo_pagato) }}</td>
                        <td>{{ p.note or '-' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 1.5rem 0;">Nessun pagamento registrato.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}