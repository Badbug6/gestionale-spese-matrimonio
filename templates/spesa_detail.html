{% extends "layout.html" %}
{% block title %}Dettaglio Spesa - {{ spesa.descrizione }}{% endblock %}
{% block content %}

<!-- Pannello riassuntivo in alto -->
<div class="panel full-width">
    <div class="panel-header">
        <h2>Dettaglio Spesa: {{ spesa.descrizione }}</h2>
        <a href="{{ url_for('index') }}" class="button-link" style="width: auto; padding: 0.6rem 1rem;">Torna alla Dashboard</a>
    </div>
    
    <div class="summary-cards">
        <div class="card">
            <h3>Costo Previsto</h3>
            <p>€ {{ "%.2f"|format(spesa.importo) }}</p>
        </div>
        <div class="card">
            <h3>Totale Pagato</h3>
            <p>€ {{ "%.2f"|format(totale_pagato) }}</p>
        </div>
        <div class="card remaining">
            <h3>Da Pagare</h3>
            <p>€ {{ "%.2f"|format(rimanente_da_pagare) }}</p>
        </div>
    </div>
</div>

<!-- Contenitore a due colonne -->
<div class="flex-container">

    <!-- Colonna sinistra: Aggiungi un nuovo pagamento -->
    <div class="panel">
        <h2>Aggiungi Pagamento</h2>
        <form action="{{ url_for('add_pagamento', spesa_id=spesa.id) }}" method="post">
            <div class="form-group">
                <label for="importo_pagato">Importo Pagato</label>
                <input type="text" name="importo_pagato" id="importo_pagato" placeholder="Es. 500.00" required>
            </div>
            <div class="form-group">
                <label for="data_pagamento">Data Pagamento</label>
                <input type="date" name="data_pagamento" id="data_pagamento" required>
            </div>
            <div class="form-group">
                <label for="note">Note (Opzionale)</label>
                <input type="text" name="note" id="note" placeholder="Es. Acconto">
            </div>
            <button type="submit">Registra Pagamento</button>
        </form>
    </div>

    <!-- Colonna destra: Storico dei pagamenti -->
    <div class="panel">
        <h2>Storico Pagamenti</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Importo</th>
                        <th>Note</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pagamento in pagamenti %}
                    <tr>
                        <td>{{ pagamento.data_pagamento }}</td>
                        <td>€ {{ "%.2f"|format(pagamento.importo_pagato) }}</td>
                        <td>{{ pagamento.note or '-' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 2rem 0;">Nessun pagamento registrato.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}